#!/usr/bin/env ruby

# Run this script from the project root directory

dir = File.dirname(__FILE__)
load File.join(dir, "../lib/common.rb")

helper = ReleaseHelper.new("flutter")

puts "Building"
helper.run "rm -rf build"
helper.run "./scripts/build-prod.sh"
helper.run "./scripts/fix-sourcemaps.sh"
tag = Tag.ask

Dir.chdir(helper.release_dir) do |dir|
  helper.run "rm -rf *"
  helper.run "git reset --hard"
  helper.run "git clean -fdx"
  helper.run "cp -R #{helper.pwd}/build/web/* ."
  helper.write_to_file("version.txt", tag)
  helper.run "git add *"
  helper.maybe_tag_and_push(tag)
end

puts ""
