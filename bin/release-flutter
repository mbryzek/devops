#!/usr/bin/env ruby

# Run this script from the project root directory

dir = File.dirname(__FILE__)
load File.join(dir, "../lib/common.rb")

Util.assert_installed("hugo")

helper = ReleaseHelper.new("flutter")

helper.run "rm -rf public"
puts "Building"
helper.run "build.sh"
tag = Tag.ask

Dir.chdir(helper.release_dir) do |dir|
  helper.run "rm -rf *"
  helper.run "git reset --hard"
  helper.run "git clean -fdx"
  helper.run "cp -R #{helper.pwd}/public ."
  helper.write_to_file("version.txt", tag)
  helper.run "git add public version.txt"
  helper.maybe_tag_and_push(tag)
end

puts ""
